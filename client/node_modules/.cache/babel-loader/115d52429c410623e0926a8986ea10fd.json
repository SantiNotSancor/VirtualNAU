{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\PC\\\\OneDrive\\\\Escritorio\\\\fabrica\\\\client\\\\src\\\\Menu\\\\deliverTask.js\",\n    _s = $RefreshSig$();\n\nimport React, { Component, useState, useEffect } from 'react';\nimport { ModalOpener } from './modalOpener';\nimport { Request, TaskRequest } from '../textInputs';\nimport Form from 'react-bootstrap/Form';\nimport image from './Images/DeliverTask.svg';\nimport moment from 'moment';\nimport Axios from 'axios';\nimport Table from 'react-bootstrap/Table';\nimport FormControl from 'react-bootstrap/FormControl';\nimport { ModalPrototype } from '../modal';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport class DeliverTaskButton extends Component {\n  constructor() {\n    super(...arguments);\n    this.state = {\n      error: true,\n      showObsModal: false,\n      task: '',\n      name: '',\n      quantity: '',\n      money: '',\n      weight: '',\n      threads: '',\n      price: '',\n      faulty: '',\n      completed: false,\n      calification: '',\n      observation: ''\n    };\n\n    this.updateError = errors => {\n      let aux = false;\n      errors.map(e => {\n        if (e) aux = e;\n      });\n    };\n\n    this.myForm = () => {\n      let errors = [true, true];\n      return /*#__PURE__*/_jsxDEV(Form, {\n        id: \"toPrint\",\n        children: [/*#__PURE__*/_jsxDEV(Request, {\n          toShow: \"name\",\n          onChange: (value, error) => {\n            this.setState({\n              name: value\n            });\n            errors[0] = error;\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 39,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          name: this.state.name,\n          onChange: (data, price, faulty, task, error, completed) => {\n            this.setState({\n              task,\n              quantity: data.quantity,\n              money: data.money,\n              weight: data.weight,\n              threads: data.threads,\n              completed,\n              price,\n              faulty\n            });\n            errors[1] = error;\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 43,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 38,\n        columnNumber: 13\n      }, this);\n    };\n\n    this.post = () => {\n      Axios.post('http://localhost:3001/getTasks', {\n        id: this.state.task\n      }).then(response => {\n        Axios.put('http://localhost:3001/payWorkshop', {\n          name: response.data[0].name,\n          money: this.state.money - this.state.quantity * this.state.price\n        });\n      });\n      Axios.post('http://localhost:3001/newPart', {\n        task: this.state.task,\n        date: moment(new Date()).format('DD/MM/YYYY'),\n        quantity: this.state.quantity,\n        weight: Number(this.state.weight).toFixed(1),\n        money: Number(this.state.money).toFixed(1),\n        threads: this.state.threads\n      }).then(() => {\n        if (this.state.completed) this.setState({\n          showObsModal: true\n        });\n      });\n    };\n\n    this.completelyReturned = () => {\n      let aux = this.state;\n      Axios.put('http://localhost:3001/printObs', {\n        id: aux.task,\n        observations: aux.observation,\n        calification: aux.calification,\n        faulty: aux.faulty\n      });\n      this.setState({\n        showObsModal: false\n      });\n    };\n\n    this.print = () => {\n      if (this.state.error) {\n        alert('Error. No se puede imprimir una boleta invÃ¡lida.');\n        return;\n      }\n\n      var printContents = document.getElementById('toPrint').innerHTML;\n      var originalContents = document.body.innerHTML;\n      document.body.innerHTML = printContents;\n      window.print();\n      document.body.innerHTML = originalContents;\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(ModalOpener, {\n        buttonText: \"Recibir tarea\",\n        children: this.myForm(),\n        logo: image,\n        className: \"title\",\n        footer: {\n          label: 'Imprimir',\n          func: this.print,\n          show: !!document.getElementById(\"taskTable\")\n        },\n        title: \"Ingreso de tarea\",\n        post: this.post,\n        error: this.state.error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(ModalPrototype, {\n        show: this.state.showObsModal,\n        post: this.completelyReturned,\n        title: \"Calificar\",\n        handleClose: () => {\n          this.completelyReturned();\n          this.setState({\n            showObsModal: false\n          });\n        },\n        children: /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(Request, {\n            toShow: \"observation\",\n            onChange: e => this.setState({\n              observation: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Request, {\n            toShow: \"calification\",\n            onChange: e => this.setState({\n              calification: e.target.value\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true);\n  }\n\n}\nexport const Input = _ref => {\n  _s();\n\n  let {\n    onChange,\n    name\n  } = _ref;\n  const [title, setTitle] = useState('Elegir tarea');\n  const [tasks, setTasks] = useState([]);\n  const [parts, setParts] = useState([]);\n  const [input, setInput] = useState({\n    quantity: 0,\n    weight: 0,\n    money: 0,\n    threads: 0\n  });\n  const [selectedTask, setSelectedTask] = useState('');\n  const [refund, setRefund] = useState(false);\n  const [completed, setCompleted] = useState(false);\n  const [account, setAccount] = useState('');\n  const [quantityBackUp, setQuantityBackUp] = useState('');\n  useEffect(() => {\n    setInput({\n      quantity: 0,\n      weight: 0,\n      money: 0,\n      threads: 0\n    });\n    Axios.post('http://localhost:3001/getParts', {\n      task: selectedTask.id\n    }).then(response => setParts(response.data));\n    if (name) Axios.post('http://localhost:3001/getAccount', {\n      name\n    }).then(response => setAccount(response.data[0].money));\n  }, [selectedTask]);\n  useEffect(() => {\n    let delivered = input.quantity;\n    let totalMoney = selectedTask.quantity * selectedTask.price - account;\n    parts.map(part => delivered += part.quantity);\n\n    if (quantityBackUp !== input.quantity) {\n      input.money = input.quantity * selectedTask.price;\n      if (input.money > totalMoney) input.money = totalMoney;\n      setQuantityBackUp(input.quantity);\n    }\n\n    onChange(input, selectedTask.price, selectedTask.quantity - delivered, selectedTask.id, !(input.quantity !== 0 && input.weight !== 0), delivered === selectedTask.quantity || completed);\n  }, [input, completed, refund]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  const inputField = (property, total) => {\n    return /*#__PURE__*/_jsxDEV(FormControl, {\n      value: input[property],\n      onChange: e => {\n        if (isNaN(e.target.value) || total[property] < e.target.value && property !== 'money') return;\n        let aux = { ...input\n        };\n        aux[property] = e.target.value;\n        aux[property] = refund ? -Math.abs(aux[property]) : aux[property] < 0 ? 0 : aux[property];\n        if (property === 'quantity' || property === 'threads') aux[property] = Math.round(aux[property]);\n        setInput({ ...aux\n        });\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 13\n    }, this);\n  };\n\n  const getTable = () => {\n    let total = {\n      quantity: selectedTask.quantity,\n      weight: selectedTask.weight,\n      money: selectedTask.quantity * selectedTask.price - account,\n      threads: selectedTask.threads\n    };\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [parts.map((part, index) => {\n        total = {\n          quantity: total.quantity - part.quantity,\n          weight: total.weight - part.weight,\n          money: total.money - part.money,\n          threads: total.threads - part.threads\n        };\n        return /*#__PURE__*/_jsxDEV(\"tr\", {\n          children: [/*#__PURE__*/_jsxDEV(\"td\", {\n            children: part.date\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            children: part.quantity\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            children: total.quantity\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            children: Number(part.weight).toFixed(1)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            children: Number(total.weight).toFixed(1)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 186,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            children: part.threads\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            children: total.threads\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            children: '$' + Number(part.money).toFixed(1)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            children: '$' + Number(total.money).toFixed(1)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 29\n          }, this)]\n        }, index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 25\n        }, this);\n      }), /*#__PURE__*/_jsxDEV(\"tr\", {\n        children: [/*#__PURE__*/_jsxDEV(\"td\", {\n          children: moment(new Date()).format('DD/MM/YYYY')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n          children: inputField('quantity', total)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n          children: total.quantity - input.quantity\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n          children: inputField('weight', total)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n          children: (total.weight - input.weight).toFixed(1)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n          children: inputField('threads', total)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n          children: total.threads - input.threads\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n          children: inputField('money', total)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n          children: '$' + (total.money - input.money).toFixed(1)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true);\n  };\n\n  const getExceeded = () => {\n    //Devuelve true si se excediÃ³ la fecha de entrega\n    if (!selectedTask.deadline) return;\n    let today = new Date();\n    today.setHours(0, 0, 0, 0);\n    var dateParts = selectedTask.deadline.split('/');\n    var deadline = new Date(+dateParts[2], dateParts[1] - 1, +dateParts[0]);\n    return today > deadline;\n  };\n\n  if (name !== '') {\n    Axios.post('http://localhost:3001/getTasks', {\n      name,\n      state: 'asigned'\n    }).then(response => {\n      if (response.data.length === 0) return;\n      setTasks(response.data);\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        'justifyContent': 'space-between',\n        'display': 'flex',\n        'alignItems': 'baseline'\n      },\n      children: [/*#__PURE__*/_jsxDEV(TaskRequest, {\n        setSelectedTask: setSelectedTask,\n        tasks: tasks,\n        title: title,\n        setTitle: setTitle\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n        style: {\n          'color': getExceeded() ? 'red' : 'green'\n        },\n        children: selectedTask === '' ? null : selectedTask.deadline\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 13\n    }, this), title === 'Elegir tarea' ? /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Form.Check, {\n        onChange: () => {\n          setRefund(!refund);\n          input.money = -input.money;\n          input.quantity = -input.quantity;\n          input.threads = -input.threads;\n          input.weight = -input.weight;\n        },\n        label: \"Devoluci\\xF3n o correcci\\xF3n\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(Form.Check, {\n        onChange: () => setCompleted(!completed),\n        label: \"Tarea cerrada\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(Table, {\n        striped: true,\n        bordered: true,\n        id: \"taskTable\",\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Fecha\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 248,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Cantidad entregada por el taller\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 249,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Cantidad total de la tarea\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 250,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Peso entregado por el taller\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 251,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Peso total\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Hilos devueltos\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 253,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Hilos totales\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 254,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Dinero entregado\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 255,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Dinero total\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 256,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 247,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: [/*#__PURE__*/_jsxDEV(\"tr\", {\n            style: {\n              'backgroundColor': 'green'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"td\", {\n              children: selectedTask.exitDate\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 261,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 262,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: selectedTask.quantity\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 263,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 264,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: selectedTask.weight\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 266,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: selectedTask.threads\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 267,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: '$' + account + ' (A CTA)'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 268,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: '$' + selectedTask.price * selectedTask.quantity\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 269,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 260,\n            columnNumber: 29\n          }, this), getTable()]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true)]\n  }, void 0, true);\n};\n\n_s(Input, \"BmUiLrZJWQkCwSvh2OvKe1WBWv4=\");\n\n_c = Input;\n\nvar _c;\n\n$RefreshReg$(_c, \"Input\");","map":{"version":3,"sources":["C:/Users/PC/OneDrive/Escritorio/fabrica/client/src/Menu/deliverTask.js"],"names":["React","Component","useState","useEffect","ModalOpener","Request","TaskRequest","Form","image","moment","Axios","Table","FormControl","ModalPrototype","DeliverTaskButton","state","error","showObsModal","task","name","quantity","money","weight","threads","price","faulty","completed","calification","observation","updateError","errors","aux","map","e","myForm","value","setState","data","post","id","then","response","put","date","Date","format","Number","toFixed","completelyReturned","observations","print","alert","printContents","document","getElementById","innerHTML","originalContents","body","window","render","label","func","show","target","Input","onChange","title","setTitle","tasks","setTasks","parts","setParts","input","setInput","selectedTask","setSelectedTask","refund","setRefund","setCompleted","account","setAccount","quantityBackUp","setQuantityBackUp","delivered","totalMoney","part","inputField","property","total","isNaN","Math","abs","round","getTable","index","getExceeded","deadline","today","setHours","dateParts","split","length","exitDate"],"mappings":"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","sourcesContent":["import React, { Component, useState, useEffect } from 'react';\r\nimport { ModalOpener } from './modalOpener';\r\nimport { Request, TaskRequest } from '../textInputs';\r\nimport Form from 'react-bootstrap/Form';\r\nimport image from './Images/DeliverTask.svg';\r\nimport moment from 'moment';\r\nimport Axios from 'axios';\r\nimport Table from 'react-bootstrap/Table';\r\nimport FormControl from 'react-bootstrap/FormControl';\r\nimport { ModalPrototype } from '../modal';\r\n\r\n\r\nexport class DeliverTaskButton extends Component {\r\n    state = {\r\n        error: true,\r\n        showObsModal: false,\r\n        task: '',\r\n        name: '',\r\n        quantity: '',\r\n        money: '',\r\n        weight: '',\r\n        threads: '',\r\n        price: '',\r\n        faulty: '',\r\n        completed: false,\r\n        calification: '',\r\n        observation: ''\r\n    }\r\n\r\n    updateError = (errors) => {\r\n        let aux = false;\r\n        errors.map((e) => {if(e) aux = e})\r\n    }\r\n\r\n    myForm = () => {\r\n        let errors = [true, true];\r\n        return (\r\n            <Form id='toPrint'>\r\n                <Request toShow='name' onChange={(value, error) => {\r\n                    this.setState({ name: value });\r\n                    errors[0] = error;\r\n                }} />\r\n                <Input name={this.state.name} onChange={(data, price, faulty, task, error, completed) => {\r\n                    this.setState({\r\n                        task, quantity: data.quantity, money: data.money, weight: data.weight,\r\n                        threads: data.threads, completed, price, faulty\r\n                    });\r\n                    errors[1] = error;\r\n                }} />\r\n            </Form>\r\n        );\r\n    }\r\n\r\n    post = () => {\r\n        Axios.post('http://localhost:3001/getTasks', { id: this.state.task }).then((response) => {\r\n            Axios.put('http://localhost:3001/payWorkshop',\r\n                { name: response.data[0].name, money: this.state.money - this.state.quantity * this.state.price })\r\n        });\r\n        Axios.post('http://localhost:3001/newPart',\r\n            {\r\n                task: this.state.task, date: moment(new Date()).format('DD/MM/YYYY'), quantity: this.state.quantity,\r\n                weight: Number(this.state.weight).toFixed(1), money: Number(this.state.money).toFixed(1), threads: this.state.threads\r\n            }).then(() => {\r\n                if (this.state.completed)\r\n                    this.setState({ showObsModal: true });\r\n            });\r\n    }\r\n\r\n    completelyReturned = () => {\r\n        let aux = this.state;\r\n        Axios.put('http://localhost:3001/printObs',\r\n            { id: aux.task, observations: aux.observation, calification: aux.calification, faulty: aux.faulty });\r\n        this.setState({ showObsModal: false })\r\n    }\r\n\r\n    print = () => {\r\n        if(this.state.error) {\r\n            alert('Error. No se puede imprimir una boleta invÃ¡lida.');\r\n            return;\r\n        }\r\n        var printContents = document.getElementById('toPrint').innerHTML;\r\n        var originalContents = document.body.innerHTML;\r\n        document.body.innerHTML = printContents;\r\n        window.print();\r\n        document.body.innerHTML = originalContents;\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <>\r\n                <ModalOpener buttonText=\"Recibir tarea\" children={this.myForm()} logo={image} className=\"title\"\r\n                    footer={{ label: 'Imprimir', func: this.print, show: !!document.getElementById(\"taskTable\") }}\r\n                    title=\"Ingreso de tarea\" post={this.post} error={this.state.error} />\r\n                {/*Crea un botÃ³n que abre a un modal en el que aparecerÃ¡ lo devuelto en this.myForm*/}\r\n\r\n                <ModalPrototype show={this.state.showObsModal} post={this.completelyReturned} title=\"Calificar\"\r\n                    handleClose={() => {\r\n                        this.completelyReturned();\r\n                        this.setState({ showObsModal: false });\r\n                    }}>\r\n                    <>\r\n                        <Request toShow=\"observation\" onChange={(e) => this.setState({ observation: e.target.value })} />\r\n                        <Request toShow=\"calification\" onChange={(e) => this.setState({ calification: e.target.value })} />\r\n                    </>\r\n                </ModalPrototype>\r\n            </>\r\n        );\r\n    }\r\n}\r\n\r\nexport const Input = ({ onChange, name }) => {\r\n\r\n    const [title, setTitle] = useState('Elegir tarea');\r\n    const [tasks, setTasks] = useState([]);\r\n    const [parts, setParts] = useState([]);\r\n    const [input, setInput] = useState({ quantity: 0, weight: 0, money: 0, threads: 0 });\r\n    const [selectedTask, setSelectedTask] = useState('');\r\n    const [refund, setRefund] = useState(false);\r\n    const [completed, setCompleted] = useState(false);\r\n    const [account, setAccount] = useState('');\r\n    const [quantityBackUp, setQuantityBackUp] = useState('');\r\n\r\n    useEffect(() => {\r\n        setInput({ quantity: 0, weight: 0, money: 0, threads: 0 });\r\n        Axios.post('http://localhost:3001/getParts', { task: selectedTask.id }).then(response => setParts(response.data));\r\n        if (name)\r\n            Axios.post('http://localhost:3001/getAccount', { name }).then(response => setAccount(response.data[0].money));\r\n    }, [selectedTask]);\r\n\r\n    useEffect(() => {\r\n        let delivered = input.quantity;\r\n        let totalMoney = selectedTask.quantity * selectedTask.price - account;\r\n        parts.map(part => delivered += part.quantity);\r\n\r\n        if (quantityBackUp !== input.quantity) {\r\n            input.money = input.quantity * selectedTask.price;\r\n            if (input.money > totalMoney)\r\n                input.money = totalMoney;\r\n            setQuantityBackUp(input.quantity);\r\n        }\r\n        onChange(input, selectedTask.price, selectedTask.quantity - delivered, selectedTask.id,\r\n            !(input.quantity !== 0 && input.weight !== 0), (delivered === selectedTask.quantity || completed));\r\n    }, [input, completed, refund]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n    const inputField = (property, total) => {\r\n        return (\r\n            <FormControl value={input[property]}\r\n                onChange={(e) => {\r\n                    if (isNaN(e.target.value) || (total[property] < e.target.value && property !== 'money'))\r\n                        return;\r\n                    let aux = { ...input };\r\n                    aux[property] = e.target.value;\r\n                    aux[property] = (refund) ?\r\n                        -Math.abs(aux[property]) :\r\n                        (aux[property] < 0) ? 0 : aux[property];\r\n                    if (property === 'quantity' || property === 'threads')\r\n                        aux[property] = Math.round(aux[property]);\r\n                    setInput({ ...aux });\r\n                }} />\r\n        );\r\n    }\r\n\r\n    const getTable = () => {\r\n\r\n        let total = {\r\n            quantity: selectedTask.quantity,\r\n            weight: selectedTask.weight,\r\n            money: selectedTask.quantity * selectedTask.price - account,\r\n            threads: selectedTask.threads\r\n        };\r\n        return (\r\n            <>\r\n                {parts.map((part, index) => {\r\n                    total = {\r\n                        quantity: total.quantity - part.quantity,\r\n                        weight: total.weight - part.weight,\r\n                        money: total.money - part.money,\r\n                        threads: total.threads - part.threads,\r\n                    };\r\n                    return (\r\n                        <tr key={index}>{/*Muestra el medio*/}\r\n                            <td>{part.date}</td>\r\n                            <td>{part.quantity}</td>\r\n                            <td>{total.quantity}</td>\r\n                            <td>{Number(part.weight).toFixed(1)}</td>\r\n                            <td>{Number(total.weight).toFixed(1)}</td>\r\n                            <td>{part.threads}</td>\r\n                            <td>{total.threads}</td>\r\n                            <td>{'$' + Number(part.money).toFixed(1)}</td>\r\n                            <td>{'$' + Number(total.money).toFixed(1)}</td>\r\n                        </tr>\r\n                    );\r\n                })}\r\n                <tr>{/*Muestra la Ãºltima fila*/}\r\n                    <td>{moment(new Date()).format('DD/MM/YYYY')}</td>\r\n                    <td>{inputField('quantity', total)}</td>\r\n                    <td>{total.quantity - input.quantity}</td>\r\n                    <td>{inputField('weight', total)}</td>\r\n                    <td>{(total.weight - input.weight).toFixed(1)}</td>\r\n                    <td>{inputField('threads', total)}</td>\r\n                    <td>{total.threads - input.threads}</td>\r\n                    <td>{inputField('money', total)}</td>\r\n                    <td>{'$' + (total.money - input.money).toFixed(1)}</td>\r\n                </tr>\r\n            </>\r\n        )\r\n    }\r\n\r\n    const getExceeded = () => {//Devuelve true si se excediÃ³ la fecha de entrega\r\n        if (!selectedTask.deadline)\r\n            return;\r\n        let today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        var dateParts = selectedTask.deadline.split('/');\r\n        var deadline = new Date(+dateParts[2], dateParts[1] - 1, +dateParts[0]);\r\n        return today > deadline;\r\n    }\r\n\r\n    if (name !== '') {\r\n        Axios.post('http://localhost:3001/getTasks', { name, state: 'asigned' }).then((response) => {\r\n            if (response.data.length === 0)\r\n                return;\r\n            setTasks(response.data);\r\n        });\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <div style={{ 'justifyContent': 'space-between', 'display': 'flex', 'alignItems': 'baseline' }}>\r\n                <TaskRequest setSelectedTask={setSelectedTask} tasks={tasks} title={title} setTitle={setTitle} />\r\n                <h4 style={{ 'color': getExceeded() ? 'red' : 'green' }}>\r\n                    {(selectedTask === '') ? null : selectedTask.deadline}\r\n                </h4>\r\n            </div>\r\n            {title === 'Elegir tarea' ? <></> :\r\n                <>\r\n                    <Form.Check onChange={() => {\r\n                        setRefund(!refund);\r\n                        input.money = -input.money;\r\n                        input.quantity = -input.quantity;\r\n                        input.threads = -input.threads;\r\n                        input.weight = -input.weight;\r\n                    }} label=\"DevoluciÃ³n o correcciÃ³n\" />\r\n                    <Form.Check onChange={() => setCompleted(!completed)} label=\"Tarea cerrada\" />\r\n                    <Table striped bordered id=\"taskTable\">\r\n                        <thead>\r\n                            <tr>\r\n                                <th>Fecha</th>\r\n                                <th>Cantidad entregada por el taller</th>\r\n                                <th>Cantidad total de la tarea</th>\r\n                                <th>Peso entregado por el taller</th>\r\n                                <th>Peso total</th>\r\n                                <th>Hilos devueltos</th>\r\n                                <th>Hilos totales</th>\r\n                                <th>Dinero entregado</th>\r\n                                <th>Dinero total</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            <tr style={{ 'backgroundColor': 'green' }}>{/*Muestra el primero*/}\r\n                                <td>{selectedTask.exitDate}</td>\r\n                                <td></td>\r\n                                <td>{selectedTask.quantity}</td>\r\n                                <td></td>\r\n                                <td>{selectedTask.weight}</td>\r\n                                <td></td>\r\n                                <td>{selectedTask.threads}</td>\r\n                                <td>{'$' + account + ' (A CTA)'}</td>\r\n                                <td>{'$' + selectedTask.price * selectedTask.quantity}</td>\r\n                            </tr>\r\n                            {getTable()}\r\n                        </tbody>\r\n                    </Table>\r\n                </>\r\n            }\r\n        </>\r\n    );\r\n}"]},"metadata":{},"sourceType":"module"}