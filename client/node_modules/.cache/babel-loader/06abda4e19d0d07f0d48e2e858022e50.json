{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\santi\\\\OneDrive\\\\Escritorio\\\\Proyecto 2022\\\\VirtualNAU\\\\client\\\\src\\\\WorkshopsAdm\\\\assignTask.js\";\nimport React, { Component } from 'react';\nimport { ModalOpener } from '../modalOpener';\nimport { Request, TaskRequest } from '../textInputs';\nimport image from './Images/assignTask.gif';\nimport Axios from 'axios';\nimport Form from 'react-bootstrap/Form';\nimport Table from 'react-bootstrap/Table';\nimport moment from 'moment';\nimport Button from 'react-bootstrap/Button';\nimport ReactToPrint from \"react-to-print\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst initialState = {\n  name: '',\n  task: '',\n  deadline: '',\n  weight: '',\n  threads: '',\n  price: 0,\n  //Auto-asignar\n  packages: '',\n  description: '',\n  quantity: '',\n  //Otros\n  error: true,\n  errors: [true, true, true, true, true, true],\n  selectedTask: null,\n  tasks: [],\n  title: 'Elegir Tarea',\n  showPrint: false\n};\nexport class AssignTaskButton extends Component {\n  constructor() {\n    super(...arguments);\n    this.state = initialState;\n    this.form = /*#__PURE__*/React.createRef();\n    this.toPrint = /*#__PURE__*/React.createRef();\n\n    this.resetState = () => {\n      this.setState(initialState);\n    };\n\n    this.updateError = (index, error) => {\n      let errors = [...this.state.errors];\n      errors[index] = error;\n      this.setState({\n        errors\n      });\n      let aux = false;\n      errors.map((e, key) => {\n        aux = aux && key === index ? error : e;\n      });\n      this.setState({\n        error: aux\n      });\n    };\n\n    this.handleEnter = event => {\n      if (event.key.toLowerCase() !== 'enter') return;\n      const form = this.form.current;\n      const index = [...form].indexOf(event.target);\n      if (form.elements[index + 1]) form.elements[index === -1 ? 1 : index + 1].focus();\n      if (event.keyCode) //Si el evento es artificial ({key = 'enter'}), no se prevendrá el evento porque no existe\n        event.preventDefault();\n    };\n\n    this.myForm = () => {\n      let defaultDeadline = new Date();\n      defaultDeadline.setDate(defaultDeadline.getDate() + 7);\n      defaultDeadline = moment(defaultDeadline).format(\"DD/MM/YYYY\"); // if(!this.state.deadline)\n      //     this.setState({deadline: defaultDeadline});\n\n      Axios.post('http://localhost:3307/getTasks', {\n        state: 'toAssign'\n      }).then(response => {\n        this.setState({\n          tasks: response.data\n        });\n      });\n      return /*#__PURE__*/_jsxDEV(Form, {\n        ref: this.form,\n        children: [this.state.selectedTask ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: [\"Bultos: \", this.state.selectedTask.packages]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 97,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n            children: [\"Descripci\\xF3n: \", this.state.selectedTask.article_description]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n            children: [\"Cantidad: \", this.state.selectedTask.quantity]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true) : null, /*#__PURE__*/_jsxDEV(TaskRequest, {\n          setSelectedTask: e => {\n            this.setState({\n              selectedTask: e,\n              quantity: e.quantity\n            });\n            this.updateError(0, !!e);\n            this.handleEnter({\n              key: 'enter'\n            });\n          },\n          tasks: this.state.tasks,\n          handleEnter: this.handleEnter,\n          title: this.state.title,\n          setTitle: e => {\n            this.setState({\n              title: e\n            });\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Request, {\n          toShow: \"workshopName\",\n          handleEnter: this.handleEnter,\n          onChange: (event, error) => {\n            this.setState({\n              name: event\n            });\n            this.updateError(1, error);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Request, {\n          toShow: \"price\",\n          value: this.state.price.toString(),\n          handleEnter: this.handleEnter,\n          onChange: (event, error) => {\n            this.setState({\n              price: event.target.value\n            });\n            this.updateError(2, error);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Request, {\n          toShow: \"deadline\",\n          value: this.state.deadline,\n          handleEnter: this.handleEnter,\n          onChange: (event, error) => {\n            let deadline = event.target.value,\n                currentYear = new Date().getFullYear(); //deadline += deadline.length < 10 ? '/' + currentYear : '';\n\n            this.setState({\n              deadline\n            });\n            console.log('hi');\n            this.updateError(3, error);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Request, {\n          toShow: \"weight\",\n          handleEnter: this.handleEnter,\n          onChange: (event, error) => {\n            this.setState({\n              weight: event.target.value\n            });\n            this.updateError(4, error);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(Request, {\n          toShow: \"threads\",\n          handleEnter: this.handleEnter,\n          onChange: (event, error) => {\n            this.setState({\n              threads: event.target.value\n            });\n            this.updateError(5, error);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 13\n      }, this);\n    };\n\n    this.print = () => {\n      this.setState({\n        showPrint: true\n      });\n      var printContents = document.getElementById('toPrint').innerHTML;\n      var originalContents = document.body.innerHTML;\n      document.body.innerHTML = printContents;\n      window.print();\n      document.body.innerHTML = originalContents;\n      this.setState({\n        showPrint: false\n      });\n    };\n\n    this.post = () => {\n      let aux = this.state;\n      this.resetState();\n      Axios.put('http://localhost:3307/assignTask', {\n        name: aux.name,\n        task: this.state.selectedTask.id,\n        deadline: aux.deadline,\n        weight: aux.weight,\n        threads: aux.threads,\n        price: aux.price,\n        exitDate: moment(new Date()).format(\"DD/MM/YYYY\")\n      });\n    };\n  }\n\n  componentDidUpdate(prevState) {\n    if (this.state.selectedTask === prevState.selectedTask && this.state.name === prevState.name) return;\n    if (!this.state.name || !this.state.selectedTask || this.state.price) return;\n    Axios.post('http://localhost:3307/getPrices', {\n      name: this.state.name,\n      article: this.state.selectedTask.article_id\n    }).then(response => {\n      //Se debe encontrar el mayor de los id que sean menores a selectedTask.id o el mayor, si no tiene menores\n      if (response.data.length === 0) return;\n      let currentId = this.state.selectedTask.id,\n          aux = response.data[0];\n      response.data.map(task => {\n        if (task.id > aux.id && task.id < currentId || task.id > currentId && (aux.id === 0 || aux.id > currentId)) aux = task;\n      });\n      this.setState({\n        price: aux.price\n      });\n    });\n  }\n\n  render() {\n    let {\n      selectedTask,\n      deadline,\n      quantity,\n      weight,\n      threads,\n      price\n    } = this.state;\n    let description = selectedTask ? selectedTask.article_description : '';\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: \"none\"\n        },\n        children: /*#__PURE__*/_jsxDEV(ComponentToPrint, {\n          ref: el => this.toPrint = el,\n          data: {\n            deadline,\n            description,\n            quantity,\n            weight,\n            threads,\n            price\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(ModalOpener, {\n        buttonText: \"Remito\",\n        handleClose: this.resetState,\n        footer: {\n          content: this.toPrint,\n          show: !this.state.error\n        },\n        error: this.state.error,\n        cardClassName: \"cardWorkshopAdm\",\n        containerClassName: \"containerWorkshopAdm\",\n        buttonClassName: \"button2WorkshopAdm\",\n        imageClassName: \"imgWorkshopAdm\",\n        logo: image,\n        title: 'Asignar Tarea',\n        post: this.post,\n        children: this.myForm()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true);\n  }\n\n}\n\nclass ComponentToPrint extends React.Component {\n  render() {\n    const {\n      data\n    } = this.props;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"toPrint\",\n      children: /*#__PURE__*/_jsxDEV(Table, {\n        striped: true,\n        bordered: true,\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Fecha\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 187,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Descripci\\xF3n de art\\xEDculo\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 188,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Cantidad\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 189,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Peso\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Hilos\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 191,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Precio por unidad\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 192,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Dinero\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 193,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 186,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            style: {\n              'backgroundColor': 'green'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"td\", {\n              children: data.deadline\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 198,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: data.description\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 199,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: data.quantity\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 200,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: data.weight\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 201,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: data.threads\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 202,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: '$' + data.price\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 203,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: '$' + data.price * data.quantity\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 204,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 197,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 13\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["C:/Users/santi/OneDrive/Escritorio/Proyecto 2022/VirtualNAU/client/src/WorkshopsAdm/assignTask.js"],"names":["React","Component","ModalOpener","Request","TaskRequest","image","Axios","Form","Table","moment","Button","ReactToPrint","initialState","name","task","deadline","weight","threads","price","packages","description","quantity","error","errors","selectedTask","tasks","title","showPrint","AssignTaskButton","state","form","createRef","toPrint","resetState","setState","updateError","index","aux","map","e","key","handleEnter","event","toLowerCase","current","indexOf","target","elements","focus","keyCode","preventDefault","myForm","defaultDeadline","Date","setDate","getDate","format","post","then","response","data","article_description","toString","value","currentYear","getFullYear","console","log","print","printContents","document","getElementById","innerHTML","originalContents","body","window","put","id","exitDate","componentDidUpdate","prevState","article","article_id","length","currentId","render","display","el","content","show","ComponentToPrint","props"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { ModalOpener } from '../modalOpener';\r\nimport { Request, TaskRequest } from '../textInputs';\r\nimport image from './Images/assignTask.gif';\r\nimport Axios from 'axios';\r\nimport Form from 'react-bootstrap/Form';\r\nimport Table from 'react-bootstrap/Table';\r\nimport moment from 'moment';\r\n\r\nimport Button from 'react-bootstrap/Button';\r\nimport ReactToPrint from \"react-to-print\";\r\n\r\nconst initialState = {\r\n    name: '',\r\n    task: '',\r\n    deadline: '',\r\n    weight: '',\r\n    threads: '',\r\n    price: 0,\r\n    //Auto-asignar\r\n    packages: '',\r\n    description: '',\r\n    quantity: '',\r\n    //Otros\r\n    error: true,\r\n    errors: [true, true, true, true, true, true],\r\n    selectedTask: null,\r\n    tasks: [],\r\n    title: 'Elegir Tarea',\r\n    showPrint: false\r\n};\r\n\r\nexport class AssignTaskButton extends Component {\r\n    state = initialState;\r\n    form = React.createRef();\r\n    toPrint = React.createRef();\r\n\r\n    resetState = () => {\r\n        this.setState(initialState);\r\n    }\r\n\r\n    updateError = (index, error) => {\r\n        let errors = [...this.state.errors];\r\n        errors[index] = error;\r\n        this.setState({ errors });\r\n\r\n        let aux = false;\r\n        errors.map((e, key) => {\r\n            aux = aux && (key === index) ? error : e;\r\n        });\r\n        this.setState({ error: aux });\r\n    }\r\n\r\n    componentDidUpdate(prevState) {\r\n        if (this.state.selectedTask === prevState.selectedTask && this.state.name === prevState.name)\r\n            return;\r\n        if (!this.state.name || !this.state.selectedTask || this.state.price)\r\n            return;\r\n        Axios.post('http://localhost:3307/getPrices',\r\n            { name: this.state.name, article: this.state.selectedTask.article_id }).then((response) => {\r\n                //Se debe encontrar el mayor de los id que sean menores a selectedTask.id o el mayor, si no tiene menores\r\n                if (response.data.length === 0)\r\n                    return;\r\n                let currentId = this.state.selectedTask.id, aux = response.data[0];\r\n                response.data.map((task) => {\r\n                    if ((task.id > aux.id && task.id < currentId) || (task.id > currentId && (aux.id === 0 || aux.id > currentId)))\r\n                        aux = task;\r\n                })\r\n                this.setState({ price: aux.price });\r\n            });\r\n    }\r\n\r\n    handleEnter = (event) => {\r\n        if (event.key.toLowerCase() !== 'enter')\r\n            return;\r\n        const form = this.form.current;\r\n        const index = [...form].indexOf(event.target);\r\n        if (form.elements[index + 1])\r\n            form.elements[(index === -1) ? 1 : index + 1].focus();\r\n        if (event.keyCode) //Si el evento es artificial ({key = 'enter'}), no se prevendrá el evento porque no existe\r\n            event.preventDefault();\r\n    };\r\n\r\n    myForm = () => {\r\n        let defaultDeadline = new Date();\r\n        defaultDeadline.setDate(defaultDeadline.getDate() + 7);\r\n        defaultDeadline = moment(defaultDeadline).format(\"DD/MM/YYYY\")\r\n        // if(!this.state.deadline)\r\n        //     this.setState({deadline: defaultDeadline});\r\n        Axios.post('http://localhost:3307/getTasks', { state: 'toAssign' }).then((response) => {\r\n            this.setState({ tasks: response.data });\r\n        });\r\n        return (\r\n            <Form ref={this.form}>\r\n                {this.state.selectedTask ?\r\n                    <>\r\n                        <h3>Bultos: {this.state.selectedTask.packages}</h3>\r\n                        <h3>Descripción: {this.state.selectedTask.article_description}</h3>\r\n                        <h3>Cantidad: {this.state.selectedTask.quantity}</h3>\r\n                    </>\r\n                    : null}\r\n\r\n                <TaskRequest setSelectedTask={(e) => {\r\n                    this.setState({ selectedTask: e, quantity: e.quantity });\r\n                    this.updateError(0, !!e);\r\n                    this.handleEnter({ key: 'enter' });\r\n                }} tasks={this.state.tasks} handleEnter={this.handleEnter}\r\n                    title={this.state.title} setTitle={(e) => { this.setState({ title: e }) }} />\r\n\r\n                <Request toShow=\"workshopName\" handleEnter={this.handleEnter} onChange={(event, error) => {\r\n                    this.setState({ name: event });\r\n                    this.updateError(1, error);\r\n                }} />\r\n\r\n                <Request toShow=\"price\" value={this.state.price.toString()} handleEnter={this.handleEnter} onChange={(event, error) => {\r\n                    this.setState({ price: event.target.value });\r\n                    this.updateError(2, error);\r\n                }} />\r\n\r\n                <Request toShow=\"deadline\" value={this.state.deadline} handleEnter={this.handleEnter} onChange={(event, error) => {\r\n                    let deadline = event.target.value, currentYear = new Date().getFullYear();\r\n                    //deadline += deadline.length < 10 ? '/' + currentYear : '';\r\n                    this.setState({ deadline });\r\n                    console.log('hi');\r\n                    this.updateError(3, error);\r\n                }} />\r\n\r\n                <Request toShow=\"weight\" handleEnter={this.handleEnter} onChange={(event, error) => {\r\n                    this.setState({ weight: event.target.value });\r\n                    this.updateError(4, error);\r\n                }} />\r\n\r\n                <Request toShow=\"threads\" handleEnter={this.handleEnter} onChange={(event, error) => {\r\n                    this.setState({ threads: event.target.value });\r\n                    this.updateError(5, error);\r\n                }} />\r\n            </Form>\r\n        );\r\n    }\r\n\r\n    print = () => {\r\n        this.setState({ showPrint: true });\r\n        var printContents = document.getElementById('toPrint').innerHTML;\r\n        var originalContents = document.body.innerHTML;\r\n        document.body.innerHTML = printContents;\r\n        window.print();\r\n        document.body.innerHTML = originalContents;\r\n        this.setState({ showPrint: false });\r\n    }\r\n\r\n    post = () => {\r\n        let aux = this.state;\r\n        this.resetState();\r\n        Axios.put('http://localhost:3307/assignTask', {\r\n            name: aux.name, task: this.state.selectedTask.id, deadline: aux.deadline, weight: aux.weight, threads: aux.threads,\r\n            price: aux.price, exitDate: moment(new Date()).format(\"DD/MM/YYYY\")\r\n        });\r\n    }\r\n\r\n    render() {\r\n        let {selectedTask, deadline, quantity, weight, threads, price} = this.state;\r\n        let description = selectedTask ? selectedTask.article_description : '';\r\n        return (\r\n            <>\r\n\r\n                {/* component to be printed */}\r\n                <div style={{ display: \"none\" }}>\r\n                    <ComponentToPrint ref={(el) => (this.toPrint = el)} data={{deadline, description, quantity, weight, threads, price}}/>\r\n                </div>\r\n                <ModalOpener buttonText='Remito' handleClose={this.resetState}\r\n                    footer={{ content: this.toPrint, show: !this.state.error }} error={this.state.error}\r\n                    cardClassName='cardWorkshopAdm' containerClassName='containerWorkshopAdm' buttonClassName='button2WorkshopAdm' imageClassName='imgWorkshopAdm' logo={image} title={'Asignar Tarea'} post={this.post} children={this.myForm()} />\r\n            {/* Crea un botón que abre a un modal en el que aparecerá lo devuelto en this.myForm */}\r\n            </>\r\n        );\r\n    }\r\n}\r\n\r\nclass ComponentToPrint extends React.Component {\r\n    render(){\r\n        const { data } = this.props;\r\n        return (\r\n            <div id=\"toPrint\">\r\n                <Table striped bordered>\r\n                    <thead>\r\n                        <tr>\r\n                            <th>Fecha</th>\r\n                            <th>Descripción de artículo</th>\r\n                            <th>Cantidad</th>\r\n                            <th>Peso</th>\r\n                            <th>Hilos</th>\r\n                            <th>Precio por unidad</th>\r\n                            <th>Dinero</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        <tr style={{ 'backgroundColor': 'green' }}>{/*Muestra el primero*/}\r\n                            <td>{data.deadline}</td>\r\n                            <td>{data.description}</td>\r\n                            <td>{data.quantity}</td>\r\n                            <td>{data.weight}</td>\r\n                            <td>{data.threads}</td>\r\n                            <td>{'$' + data.price}</td>\r\n                            <td>{'$' + data.price * data.quantity}</td>\r\n                        </tr>\r\n                    </tbody>\r\n                </Table>\r\n            </div>\r\n        );\r\n    }\r\n\r\n}"]},"metadata":{},"sourceType":"module"}